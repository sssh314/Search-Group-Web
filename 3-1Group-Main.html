<!DOCTYPE html>
<html lang="ko">
<head>
    <script>
        //버튼에 커서 올리면 
        function Onmousein(button){
            button.style.backgroundColor = "#404040";
        }
        function Onmouseout(button){
            button.style.backgroundColor = "#212121";
        }
        function goMain(){
          location.href = "2-1Search-Main.html";
        }
        function getGroupIdFromURL(){
            const params = new URLSearchParams(location.search);
            return params.get("group_id");
        }
        window.onload = function() {
          const userName = localStorage.getItem("user_name");
          const userId = localStorage.getItem("user_id");

          // groups 배열 
          let groups = JSON.parse(localStorage.getItem("groups")) || [];

          // url에서 group_id 가져옴
          const params = new URLSearchParams(location.search);
          const groupId = params.get("group_id");

          // url에서 찾은 id와 groups에서 일치하는 id를 찾아서 groupData에 저장 
          let groupData = groups.find(g => g.id == groupId);

          if(!groupData){
            alert("존재하지 않는 모임입니다.");
            return;
          }

          const actionBtn = document.getElementById("actionBtn");

          let people = Array.isArray(groupData.people) ? groupData.people : [];
          //console.log("People =", people);
          const maxPeople = parseInt(groupData.maxPeople);
          //console.log("maxPeople =", groupData.maxPeople);
          // groupData.people이 없다면 
          if (isNaN(maxPeople)) {
              alert("최대 인원 정보가 없습니다. 모임 정보가 잘못되었습니다.");
              return;
          }

          // 그룹 만든 사람의 이름을 인원(people)에 등록 
          if (people.length === 0){
            if(groupData.creator) people.push(groupData.creator);
          }

          // 인원이 가입하거나 탈퇴하면 groups를 다시 저장 
          function saveGroups(){
            localStorage.setItem("groups", JSON.stringify(groups));
          }

          function updateButton(){
            document.getElementById("groupNameTitle").textContent = groupData.name;
            document.getElementById("planTime").textContent = groupData.time;
            document.getElementById("planLocation").textContent = groupData.location;
            document.getElementById("planDate").textContent = groupData.date;
            document.getElementById("groupNotice").textContent =
              groupData.notice && groupData.notice.trim()
                ? groupData.notice
                : "공지사항이 없습니다.";


            //인원 표시 
            const groupPeopleDiv = document.getElementById("groupPeople");
            groupPeopleDiv.innerHTML = ""; // 기존 내용 초기화

            if(people.length > 0){
                people.forEach(name => {
                    const personDiv = document.createElement("div");
                    personDiv.textContent = name;
                    // 블럭 스타일
                    personDiv.style.backgroundColor = "#404040";
                    personDiv.style.color = "white";
                    personDiv.style.padding = "10px";
                    personDiv.style.borderRadius = "8px";
                    personDiv.style.margin = "5px 0";
                    personDiv.style.width = "100%"; // 글자 길이만큼 폭
                    personDiv.style.boxSizing = "border-box";
                    groupPeopleDiv.appendChild(personDiv);
                });
            } else {
                groupPeopleDiv.textContent = "모임 인원 없음";
            }

            //사용자에 따른 버튼 변경 
            if(userId === groupData.creatorId){
              actionBtn.textContent = "모임 편집";
              actionBtn.onclick = function() {
                location.href = `4-1Group-Setting.html?group_id=${groupId}`; 
              };
            } else if (people.includes(userName)){
              actionBtn.textContent = "탈퇴";
              actionBtn.onclick = function(){
                // people에서 현재 사용자의 이름과 같지 않은 사람만 남긴다. -> 이름 중복시 오류 가능 
                people = people.filter(name => name !== userName);
                //남은 이름 저장 
                groupData.people = people;
                saveGroups();
                alert("모임에서 탈퇴했습니다.");
                updateButton();
              };
            } else{
              actionBtn.textContent = "가입";
              actionBtn.onclick = function(){
                if(people.length >= maxPeople){
                  alert("정원이 가득 찼습니다.");
                  return;
                }
                people.push(userName);
                groupData.people = people;
                saveGroups();
                alert(`${userName}님이 모임에 가입했습니다.`);
                updateButton();
              };
            }

          }
          updateButton();
          // 댓글 배열 초기화
          if (!Array.isArray(groupData.comments)) {
            groupData.comments = [];
          }

          // 댓글 렌더링
          function renderComments() {
            const commentList = document.getElementById("commentList");
            commentList.innerHTML = "";

            if (groupData.comments.length === 0) {
              commentList.innerHTML = "<p style='color:#909090;'>댓글이 없습니다.</p>";
              return;
            }

            groupData.comments.forEach(c => {
              const div = document.createElement("div");
              div.textContent = `${c.user}: ${c.text}`;
              div.style.background = "#404040";
              div.style.color = "white";
              div.style.padding = "8px";
              div.style.borderRadius = "8px";
              div.style.marginBottom = "6px";
              commentList.appendChild(div);
            });
          }

          // 댓글 추가
          window.addComment = function () {
            const input = document.getElementById("commentInput");
            const text = input.value.trim();

            if (!text) return;

            groupData.comments.push({
              user: userName,
              text: text,
              time: Date.now()
            });

            saveGroups();
            input.value = "";
            renderComments();
          };

          // 최초 렌더링
          renderComments();

        };
    </script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>스터디 모임 플랫폼</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #212121;
  }

  header {
    background-color: #212121;
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
  }

  header h1 {
    margin: 0;
    cursor: pointer;
  }

  header button {
    background-color: #212121;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: bold;
  }

  .container {
    max-width: 1000px;
    margin: 30px auto;
    padding: 0 20px;
  }
  .top-controls {
    display: flex;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 10px;
  }
  .group-top{
    display: flex;
    flex: 1;
    color: white;
    size: 1rem;
    justify-content:space-between;
  }
  .group-top h1{
    margin: 0;
  }
  .group-top button{
    background-color: #212121;
    color: white;
    border-radius: 20px;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
  }
  .announcement {
    background-color: #171717;
    padding: 15px;
    min-height: 100px;
    border-radius: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  .announcement p{
    margin-top: 0;
    color: white;
  }
  .notice-text {
    font-size: 0.85rem;
    color: #bdbdbd;
    margin-top: 8px;
    white-space: pre-wrap; /* 줄바꿈 유지 */
  }

  .noticeboard{
    display: grid;
    grid-template-columns: 200px 1fr 200px;
    grid-template-rows: 375px;
    gap: 20px;
  }
  .people{
    background-color: #171717;
    border-radius: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    padding: 15px;
  }
  .people h3{
    margin-top: 0;
    color: white;
  }
  .note {
    background-color: #171717;
    border-radius: 15px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    height: 100%; /* 부모(grid)에 맞춤 */
  }
  .note h3{
    margin-top: 0;
    color: white;
  }
  /* 댓글 목록 영역 */
  .comment-box {
    flex: 1;
    overflow-y: auto;
    margin-bottom: 10px;
    padding-right: 5px;
  }

  /* 댓글 하나 */
  .comment-box div {
    background-color: #404040;
    color: white;
    padding: 8px;
    border-radius: 8px;
    margin-bottom: 6px;
    font-size: 0.9rem;
  }

  /* 입력 영역 */
  .comment-input {
    display: flex;
    gap: 8px;
  }

  .comment-input input {
    flex: 1;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #404040;
    background: #303030;
    color: white;
    outline: none;
  }

  .comment-input button {
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    background: #404040;
    color: white;
    cursor: pointer;
  }

  .plan {
    background-color: #171717;
    border-radius: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    padding: 15px;
    color: white;
  }

  .plan-grid {
    display: grid;
    grid-template-columns: 180px;
    grid-template-rows: 110px 110px 110px;
    gap: 15px;
  }

  .plan-item h3 {
    margin: 0 0 10px 0;
    color: white;
  }

  .plan-item p {
    margin: 0;
    color: #dddddd;
  }
</style>
</head>
<body>

<header>
  <h1 onclick="goMain()">모임 찾기</h1>
  <button onmouseover="Onmousein(this)" onmouseout="Onmouseout(this)">마이페이지</button>
</header>

<div class="container">
    <div class="top-controls">
        <div class="group-top">
            <h1 id="groupNameTitle">모임 이름</h1>
            <button id="actionBtn" onmouseover="Onmousein(this)" onmouseout="Onmouseout(this)">버튼</button>
        </div>
    </div>
    <div class="announcement">
      <p>공지사항</p>
      <p id="groupNotice" class="notice-text"></p>
    </div>

    <div class="noticeboard">
        <div class="people">
            <h3>인원</h3>
            <p id="groupPeople" style="color:white; margin-top:10px;">모임 인원</p>
        </div>
        <div class="note">
            <h3>의견</h3>

            <!-- 댓글 목록 -->
            <div class="comment-box" id="commentList"></div>

            <!-- 댓글 입력 -->
            <div class="comment-input">
                <input id="commentInput" type="text" placeholder="댓글을 입력하세요">
                <button onclick="addComment()">등록</button>
            </div>
        </div>

        <div class="plan">

          <div class="plan-grid">

            <div class="plan-item">
                <h3>시간</h3>
                <p id="planTime">--:--</p>
            </div>

            <div class="plan-item">
                <h3>장소</h3>
                <p id="planLocation">장소 미정</p>
            </div>

            <div class="plan-item">
                <h3>날짜</h3>
                <p id="planDate">YYYY-MM-DD</p>
            </div>

          </div>
        </div>
    </div> 
</div>

</body>
</html>
